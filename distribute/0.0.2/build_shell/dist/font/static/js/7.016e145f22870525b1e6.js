webpackJsonp([7],{F3h5:function(t,e,i){"use strict";var s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.item.Display?i("Card",{staticClass:"citask-card",attrs:{bordered:!1}},[i("div",{staticClass:"citask-card-title"},[i("a",{staticStyle:{color:"inherit","text-decoration":"underline"},attrs:{href:t.item.TaskHistoryURI}},[t._v("\n      "+t._s(t.item.TaskName)+"\n    ")]),t._v(" "),i("span",{staticClass:"pull-right",staticStyle:{"padding-right":"10px"}},[i("a",{attrs:{href:t.item.TaskConfigURI}},[i("Icon",{staticStyle:{"margin-left":"10px"},attrs:{type:"ios-settings",size:18,color:"#555"}})],1)])]),t._v(" "),i("div",{staticClass:"citask-card-body"},[i("span",{staticStyle:{width:"220px",display:"inline-block","text-align":"left"}},[i("span",{staticStyle:{"margin-top":"25px","margin-left":"0px"}},[1===t.item.LastRunStatus?i("Icon",{staticStyle:{color:"#388e83"},attrs:{type:"ios-checkmark-circle"}}):t._e(),t._v(" "),2===t.item.LastRunStatus?i("Icon",{staticStyle:{color:"darkred"},attrs:{type:"ios-close-circle"}}):t._e(),t._v(" "),3===t.item.LastRunStatus?i("Icon",{staticStyle:{color:"olive"},attrs:{type:"ios-remove-circle"}}):t._e(),t._v("\n          "+t._s(t.item.LastRunTime)+" ")],1)]),t._v(" "),i("span",{staticStyle:{width:"80px","margin-top":"25px",display:"inline-block"}},[t.item.ParameterGroups.length>0?i("Dropdown",{attrs:{trigger:"click"},on:{"on-click":t.onDPItemClick}},[i("Button",{staticStyle:{padding:"3px 15px"},attrs:{type:"default",shape:"circle"}},[t._v("\n          构建\n          "),i("Icon",{attrs:{type:"md-arrow-dropdown"}})],1),t._v(" "),i("DropdownMenu",{staticStyle:{"max-height":"500px","overflow-y":"scroll",top:"0px"},attrs:{slot:"list"},slot:"list"},t._l(t.item.ParameterGroups,function(e){return i("DropdownItem",{key:e.id,attrs:{name:e.id+","+t.item.id}},[e.default?i("Icon",{attrs:{type:"checkmark-round"}}):t._e(),t._v(" "+t._s(e.title))],1)}))],1):t._e(),t._v(" "),0===t.item.ParameterGroups.length?i("Button",{staticStyle:{padding:"3px 15px"},attrs:{type:"default",shape:"circle"},on:{click:function(e){t.onBuildClick(t.item.id)}}},[t._v("\n          构建\n      ")]):t._e()],1)])]):t._e()],1)},staticRenderFns:[]};var o=i("VU/8")({name:"ciTaskItem",props:["item"],data:function(){return{msg:""}},methods:{onDPItemClick:function(t){var e=this,i=t.split(",");this.$axios.get("/api/ci/task_basic/"+i[1]+"/start/?BuildParameter="+i[0]).then(function(t){e.$Message.success({content:t.data.result.message,duration:10})},function(t){e.$Message.error({content:t.data.result.message,duration:10})})},onBuildClick:function(t){var e=this;this.$axios.get("/api/ci/task_basic/"+t+"/start/").then(function(t){e.$Message.success({content:t.data.result.message,duration:10})},function(t){e.$Message.error({content:t.data.result.message,duration:10})})}}},s,!1,function(t){i("a4JU")},"data-v-51a23638",null);e.a=o.exports},XGNi:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("Dd8w"),o=i.n(s),n=(i("IcnI"),i("NYxO")),a=i("HA7x"),c=i("mM4c"),r=i("F3h5"),l=i("P7xe"),d={name:"ciTaskFlowItem",props:["flowID"],data:function(){return{taskFlow:{},currentSection:0}},computed:o()({},Object(n.c)("citaskflow",["addedSection","ciTaskAddedToSection","sectionRenamed"]),Object(n.c)(["appBodyHeight"]),{taskContainerHeight:function(){return this.appBodyHeight},taskFlowID:function(){return this.flowID+""=="undefined"?0:this.flowID},sectionID:function(){return this.currentSection}}),methods:o()({},Object(n.d)("citaskflow",["setAddedSection","setAddedSectionDialogShow","setSectionRenamed","setRenameSectionDialogShow","setCITaskAddedToSectionDialogShow","setCITaskAddedToSection"]),{loadFlowTasks:function(t){var e=this;t+""!="0"&&this.$axios.get("/api/ci/task_flow/"+t+"/").then(function(t){e.taskFlow=t.data.result},function(t){})},editSection:function(t){this.currentSection=t,this.setCITaskAddedToSectionDialogShow(!0)},onReachBottom:function(t){},onEnd:function(t){console.log(t);var e=t.to.getAttribute("id"),i=t.from.getAttribute("id"),s=t.item.getAttribute("id"),o=t.oldIndex,n=this.findSection(e),a=this.findSection(i);n.CITaskIDs.push(s),a.CITaskIDs.splice(o,1),console.log(n),console.log(a),this.$axios.patch("/api/ci/task_flow/section/"+e,{CITasks:n.CITaskIDs.toString()}).then(function(t){console.log(t)},function(t){}),this.$axios.patch("/api/ci/task_flow/section/"+i,{CITasks:a.CITaskIDs.toString()}).then(function(t){console.log(t)},function(t){})},flowContextMenuClick:function(t){var e=this,i=t.split(":"),s=i[0],o=i[1];if(this.currentSection=o,"rename"===s&&this.setRenameSectionDialogShow(!0),"start"===s&&this.startSection(o),"delete"===s){var n=this.findSection(o).SectionName;this.$Modal.confirm({title:"删除确认",content:"<p>删除是危险操作，确认要删除任务阶段 ["+n+" ] 吗？</p>",onOk:function(){e.deleteFlowSection(o)},onCancel:function(){}})}},deleteFlowSection:function(t){var e=this;this.$axios.delete("/api/ci/task_flow/section/"+t).then(function(t){e.loadFlowTasks(e.taskFlowID)},function(t){})},startSection:function(t){var e=this;this.$axios.get("/api/ci/flow_section/"+t+"/start/").then(function(t){e.$Message.success({content:t.data.result.message,duration:10})},function(t){})},findSection:function(t){for(var e=null,i=0;i<this.taskFlow.Sections.length;i++)if(this.taskFlow.Sections[i].id+""===t){e=this.taskFlow.Sections[i];break}return e}}),created:function(){this.loadFlowTasks(this.taskFlowID)},watch:{addedSection:function(t){t&&(this.loadFlowTasks(this.taskFlowID),this.setAddedSection(!1))},sectionRenamed:function(t){t&&(this.loadFlowTasks(this.taskFlowID),this.setSectionRenamed(!1))},ciTaskAddedToSection:function(t){t&&(this.loadFlowTasks(this.taskFlowID),this.setCITaskAddedToSection(!1))},taskFlowID:function(){this.loadFlowTasks(this.taskFlowID)}},components:{SectionCreateDialog:a.a,ciTaskItem:r.a,FlowSection:l.a,TaskAddToSectionDialog:c.a}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{style:"height:"+t.taskContainerHeight+"px; overflow-y:scroll;padding-left:10px;padding-right:10px;"},[t._l(t.taskFlow.Sections,function(e){return i("flow-section",{key:e.id,staticStyle:{"margin-left":"10px"},attrs:{columnID:e.id,group:t.taskFlowID,itemList:e.Tasks,columnTitle:e.SectionName,dishover:!1,shadow:!1,bordered:!0},on:{"update:itemList":function(i){t.$set(e,"Tasks",i)},end:t.onEnd,reachBottom:t.onReachBottom},scopedSlots:t._u([{key:"default",fn:function(t){return[i("ci-task-item",{attrs:{item:t.element}})]}}])},[i("Card",{staticClass:"board-column-title",attrs:{slot:"column-header",bordered:!1,shadow:!1,"dis-hover":!0},slot:"column-header"},[i("span",[i("Avatar",{staticStyle:{border:"1px solid black","background-color":"#f5f7f9",color:"#5f5f5f","margin-right":"10px"},attrs:{size:"small"}},[t._v(t._s(e.SectionIndex))]),t._v(" "),i("span",{staticStyle:{"font-size":"16px"}},[t._v(t._s(e.SectionName))])],1),t._v(" "),i("span",{staticClass:"pull-left cursor-hand",on:{click:function(i){t.editSection(e.id)}}},[e.Tasks.length<1?i("Icon",{attrs:{type:"md-add",size:16,color:"#388e83"}}):t._e(),t._v(" "),e.Tasks.length>0?i("Icon",{attrs:{type:"ios-create-outline",size:16,color:"#388e83"}}):t._e()],1),t._v(" "),i("span",{staticClass:"pull-right cursor-hand",staticStyle:{color:"#5f5f5f","margin-right":"-6px"}},[i("Dropdown",{on:{"on-click":t.flowContextMenuClick}},[i("i",{staticClass:"fa fa-bars fa-fw"}),t._v(" "),i("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[i("DropdownItem",{staticStyle:{height:"20px","padding-top":"2px","text-align":"left"},attrs:{name:"start:"+e.id}},[i("span",{staticStyle:{"margin-right":"5px"}},[i("Icon",{attrs:{type:"md-play"}})],1),t._v(" "),i("span",[t._v("执行")])]),t._v(" "),i("DropdownItem",{staticStyle:{height:"20px","padding-top":"2px","text-align":"left"},attrs:{name:"rename:"+e.id}},[i("span",{staticStyle:{"margin-right":"5px"}},[i("Icon",{attrs:{type:"md-create"}})],1),t._v(" "),i("span",[t._v("重命名")])]),t._v(" "),i("DropdownItem",{staticStyle:{height:"20px","padding-top":"2px","text-align":"left"},attrs:{name:"delete:"+e.id}},[i("span",{staticStyle:{"margin-right":"5px"}},[i("Icon",{attrs:{type:"ios-trash"}})],1),t._v(" "),i("span",[t._v("删除")])])],1)],1)],1)])],1)}),t._v(" "),i("section-create-dialog",{attrs:{flowID:t.taskFlowID,sectionID:t.sectionID}}),t._v(" "),i("task-add-to-section-dialog",{attrs:{sectionID:t.sectionID}})],2)},staticRenderFns:[]};var p=i("VU/8")(d,u,!1,function(t){i("ZOQJ")},"data-v-c8ec9b2a",null);e.default=p.exports},ZOQJ:function(t,e){},a4JU:function(t,e){}});
//# sourceMappingURL=7.016e145f22870525b1e6.js.map